<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DALL-E Image Generation API</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Header -->
                <div class="text-center mb-5">
                    <h1 class="display-4 mb-3">
                        <i class="fas fa-image text-primary me-3"></i>
                        DALL-E Image Generation API
                    </h1>
                    <p class="lead">Минималистичное API для генерации изображений и текста через OpenAI</p>
                </div>

                <!-- API Documentation -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3><i class="fas fa-code me-2"></i>API Документация</h3>
                    </div>
                    <div class="card-body">
                        <h5>Endpoints для работы с OpenAI API</h5>
                        <div class="bg-dark p-3 rounded mb-3">
                            <code>POST /api/generate-image</code> - Генерация изображений<br>
                            <code>POST /api/generate-text</code> - Генерация текста
                        </div>
                        
                        <h6>Параметры для генерации изображений (/api/generate-image):</h6>
                        <table class="table table-bordered mb-4">
                            <thead>
                                <tr>
                                    <th>Параметр</th>
                                    <th>Тип</th>
                                    <th>Обязательный</th>
                                    <th>Описание</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>prompt</code></td>
                                    <td>string</td>
                                    <td>Да</td>
                                    <td>Описание изображения для генерации (макс. 1000 символов)</td>
                                </tr>
                                <tr>
                                    <td><code>size</code></td>
                                    <td>string</td>
                                    <td>Нет</td>
                                    <td>Размер изображения: 256x256, 512x512, 1024x1024, 1792x1024, 1024x1792 (по умолчанию: 1024x1024)</td>
                                </tr>
                            </tbody>
                        </table>

                        <h6>Параметры для генерации текста (/api/generate-text):</h6>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Параметр</th>
                                    <th>Тип</th>
                                    <th>Обязательный</th>
                                    <th>Описание</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>prompt</code></td>
                                    <td>string</td>
                                    <td>Да</td>
                                    <td>Текстовый запрос или вопрос (макс. 4000 символов)</td>
                                </tr>
                                <tr>
                                    <td><code>max_tokens</code></td>
                                    <td>integer</td>
                                    <td>Нет</td>
                                    <td>Максимальное количество токенов в ответе: 1-4000 (по умолчанию: 1000)</td>
                                </tr>
                                <tr>
                                    <td><code>model</code></td>
                                    <td>string</td>
                                    <td>Нет</td>
                                    <td>Модель GPT: gpt-4, gpt-4-turbo, gpt-3.5-turbo (по умолчанию: gpt-4)</td>
                                </tr>
                            </tbody>
                        </table>

                        <h6>Пример успешного ответа (изображение):</h6>
                        <pre class="bg-dark p-3 rounded"><code>{
  "success": true,
  "image_url": "https://oaidalleapiprodscus.blob.core.windows.net/...",
  "prompt": "A beautiful sunset over mountains",
  "size": "1024x1024"
}</code></pre>

                        <h6>Пример успешного ответа (текст):</h6>
                        <pre class="bg-dark p-3 rounded"><code>{
  "success": true,
  "text": "Привет! У меня все отлично, спасибо. Как у тебя дела?",
  "prompt": "Привет! Как дела?",
  "model": "gpt-3.5-turbo",
  "tokens_used": 43
}</code></pre>

                        <h6>Пример ошибки:</h6>
                        <pre class="bg-dark p-3 rounded"><code>{
  "success": false,
  "error": "Missing prompt",
  "message": "Please provide a 'prompt' field with your image description"
}</code></pre>
                    </div>
                </div>

                <!-- Code Examples -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3><i class="fas fa-terminal me-2"></i>Примеры использования</h3>
                    </div>
                    <div class="card-body">
                        <!-- cURL Examples -->
                        <h5>cURL - Генерация изображений</h5>
                        <pre class="bg-dark p-3 rounded mb-3"><code>curl -X POST {{ request.url_root }}api/generate-image \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "A futuristic city with flying cars at sunset",
    "size": "1024x1024"
  }'</code></pre>

                        <h5>cURL - Генерация текста</h5>
                        <pre class="bg-dark p-3 rounded mb-4"><code>curl -X POST {{ request.url_root }}api/generate-text \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "Объясни квантовую физику простыми словами",
    "max_tokens": 500,
    "model": "gpt-4"
  }'</code></pre>

                        <!-- Python Example -->
                        <h5>Python (requests)</h5>
                        <pre class="bg-dark p-3 rounded mb-4"><code>import requests
import json

url = "{{ request.url_root }}api/generate-image"
data = {
    "prompt": "A futuristic city with flying cars at sunset",
    "size": "1024x1024"
}

response = requests.post(url, json=data)
result = response.json()

if result["success"]:
    print(f"Image URL: {result['image_url']}")
else:
    print(f"Error: {result['message']}")
</code></pre>

                        <!-- JavaScript Example -->
                        <h5>JavaScript (fetch)</h5>
                        <pre class="bg-dark p-3 rounded mb-4"><code>const response = await fetch('{{ request.url_root }}api/generate-image', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    prompt: 'A futuristic city with flying cars at sunset',
    size: '1024x1024'
  })
});

const result = await response.json();

if (result.success) {
  console.log('Image URL:', result.image_url);
} else {
  console.error('Error:', result.message);
}
</code></pre>
                    </div>
                </div>

                <!-- Interactive Test -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3><i class="fas fa-play me-2"></i>Интерактивный тест</h3>
                    </div>
                    <div class="card-body">
                        <form id="testForm">
                            <div class="mb-3">
                                <label for="promptInput" class="form-label">Описание изображения:</label>
                                <textarea class="form-control" id="promptInput" rows="3" 
                                    placeholder="Например: A beautiful landscape with mountains and a lake at golden hour"
                                    required></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="sizeSelect" class="form-label">Размер:</label>
                                <select class="form-select" id="sizeSelect">
                                    <option value="1024x1024" selected>1024x1024 (квадратное)</option>
                                    <option value="1792x1024">1792x1024 (широкое)</option>
                                    <option value="1024x1792">1024x1792 (высокое)</option>
                                    <option value="512x512">512x512 (маленькое квадратное)</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary" id="generateBtn">
                                <i class="fas fa-magic me-2"></i>Сгенерировать изображение
                            </button>
                        </form>
                        
                        <div id="loadingSpinner" class="text-center mt-4" style="display: none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Генерация...</span>
                            </div>
                            <p class="mt-2">Генерирую изображение... Это может занять до 30 секунд.</p>
                        </div>
                        
                        <div id="result" class="mt-4"></div>
                    </div>
                </div>

                <!-- Health Check -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h3><i class="fas fa-heartbeat me-2"></i>Статус сервиса</h3>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-outline-info" id="healthCheckBtn">
                            <i class="fas fa-sync me-2"></i>Проверить статус
                        </button>
                        <div id="healthResult" class="mt-3"></div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="text-center mt-5 mb-4">
                    <p class="text-muted">
                        <i class="fas fa-info-circle me-2"></i>
                        Этот API использует OpenAI DALL-E 3 для генерации изображений
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test form functionality
        document.getElementById('testForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const prompt = document.getElementById('promptInput').value.trim();
            const size = document.getElementById('sizeSelect').value;
            const generateBtn = document.getElementById('generateBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultDiv = document.getElementById('result');
            
            if (!prompt) {
                resultDiv.innerHTML = '<div class="alert alert-warning">Пожалуйста, введите описание изображения</div>';
                return;
            }
            
            // Show loading state
            generateBtn.disabled = true;
            loadingSpinner.style.display = 'block';
            resultDiv.innerHTML = '';
            
            try {
                const response = await fetch('/api/generate-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt, size })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h5><i class="fas fa-check-circle me-2"></i>Изображение успешно сгенерировано!</h5>
                            <p><strong>Промпт:</strong> ${result.prompt}</p>
                            <p><strong>Размер:</strong> ${result.size}</p>
                            <div class="mt-3">
                                <img src="${result.image_url}" class="img-fluid rounded shadow" alt="Generated image" style="max-width: 100%; height: auto;">
                            </div>
                            <div class="mt-3">
                                <a href="${result.image_url}" target="_blank" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-external-link-alt me-1"></i>Открыть в новой вкладке
                                </a>
                            </div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <h5><i class="fas fa-exclamation-triangle me-2"></i>Ошибка</h5>
                            <p><strong>Тип ошибки:</strong> ${result.error}</p>
                            <p><strong>Сообщение:</strong> ${result.message}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h5><i class="fas fa-exclamation-triangle me-2"></i>Ошибка сети</h5>
                        <p>Не удалось выполнить запрос: ${error.message}</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                loadingSpinner.style.display = 'none';
            }
        });

        // Health check functionality
        document.getElementById('healthCheckBtn').addEventListener('click', async function() {
            const button = this;
            const resultDiv = document.getElementById('healthResult');
            
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Проверяю...';
            
            try {
                const response = await fetch('/health');
                const result = await response.json();
                
                const statusColor = result.status === 'healthy' ? 'success' : 'danger';
                const openaiStatus = result.openai_configured ? 'настроен' : 'не настроен';
                const openaiColor = result.openai_configured ? 'success' : 'warning';
                
                resultDiv.innerHTML = `
                    <div class="alert alert-${statusColor}">
                        <h6><i class="fas fa-info-circle me-2"></i>Статус сервиса</h6>
                        <p><strong>Сервис:</strong> ${result.service}</p>
                        <p><strong>Статус:</strong> <span class="badge bg-${statusColor}">${result.status}</span></p>
                        <p><strong>OpenAI API:</strong> <span class="badge bg-${openaiColor}">${openaiStatus}</span></p>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <p><i class="fas fa-exclamation-triangle me-2"></i>Ошибка при проверке статуса: ${error.message}</p>
                    </div>
                `;
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-sync me-2"></i>Проверить статус';
            }
        });

        // Auto-check health on page load
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('healthCheckBtn').click();
        });
    </script>
</body>
</html>
